:PROPERTIES:
:ID:       e2ab84be-ecc1-4556-b23e-a074ba0b8f10
:END:
#+TITLE: Emacs: Learning GNUS
#+CATEGORY: slips
#+TAGS:

* Roam
+ [[id:6f769bd4-6f54-4da7-a329-8cf5226128c9][Emacs]]
+ [[id:286b6d1b-362b-44fe-bb19-e0e78513d615][GNU]]
+ [[id:8fb0a586-9c0f-4f36-b1ab-dc5c26681d15][OSS]]

* Resources

+ [[https://github.com/redguardtoo/mastering-emacs-in-one-year-guide/blob/master/gnus-guide-en.org][gnus]] in [[github:redguardtoo/mastering-emacs-in-one-year-guide][redguardtoo/mastering-emacs-in-one-year-guide]]

** Configs

*** [[https://github.com/dickmao/gnus-imap-walkthrough/blob/master/dot.emacs][dickmao/gnus-imap-walkthrough]]

A fairly complete split-imap configuration featuring multiple IMAP accounts,
dovecot/mbsync, and setup scripts -- along with CI scripts for testing.

** Videos

*** [[https://www.youtube.com/watch?v=hbCXqDT1iNI][How to set up Gnus in Emacs for GMAIL in a seven minutes]]

Quick overview on configuring GNUS.

*** [[https://www.youtube.com/watch?v=jwz7aYUWIbM][Emacs: Introduction to GNUS]]

Video from Prot on GNUS. See also [[https://github.com/protesilaos/dotfiles/blob/master/emacs/.emacs.d/prot-emacs-modules/prot-emacs-gnus.el][prot-emacs-gnus.el]]

*** [[https://emacsconf.org/2022/talks/mail/][Revisiting the anatomy of Emacs mail user agents]]

Interesting presentation on holistic design of Email applications at a general
level. Compares/contrasts the architecture of email applications but also covers
specific architectural patterns seen in Emacs & open source.

Some great flow-charts here on split-IMAP email configurations for Emacs that
I'm imagining are a bit hard-to-find elsewhere. Also on [[https://www.youtube.com/watch?v=dJXBUlbxU3E][youtube]].

* Workflows

I have multiple computers from which I may use emacs. i believe I will use GNUS
mostly from one laptop, but this laptop needs work.

** Quitting Gnus

** Syncing Data

Functionality could be configured the =init.el= for Emacs or in =gnus.el=.

*** Gnus Cloud

[[https://www.gnu.org/software/emacs/manual/html_node/gnus/The-Gnus-Cloud.html][Gnus Cloud]] stores Gnus data in an IMAP folder & sync multiple clients to it.

+ Marks are synchronized for =nnimap= groups, but not for other types of groups
+ "General data and other files" will be synced for most group types, if I'm
  interpreting this correctly (I have yet to configure it).

The [[https://www.gnu.org/software/emacs/manual/html_mono/gnus.html#The-Gnus-Cloud][Gnus Cloud package]] has four variables. The docs describe it best.

From the group buffer: =~ d= to download and =~ u= to upload

+ The EPG integration (Emacs GPG integration) is transparent, which is
  configured in =gnus-cloud-storage-method=.
+ To sync the data, it calls =gnus-cloud-encode-data= and eventually
  =epg-encrypt-string=. For it to do so, =(gpg-make-context 'OpenPGP)= will need
  to successfully create a context representing your GPG configuration. It
  should be able to read most of what it needs via =gpgconf=.
+ Since it uses =epg-encrypt-string= with symmetric encryption for the content,
  I don't know of any way to precache the file's password into GPG. unless GPG
  will try a generic cached password (which it may). This means that to encrypt
  the backup for the first time, you must have =(setq epg-pinentry-mode
  'loopback)= or the encryption will fail. This is the most convenient option
  for this variable anyways.

*** Gnus Registry

[[https://www.gnu.org/software/emacs/manual/html_node/gnus/The-Gnus-Registry.html][Gnus Registry]]

*** Startup

**** [[https://emacs.stackexchange.com/questions/34537/how-to-prevent-gnus-from-querying-the-server-during-startup][How to prevent Gnus from querying the server during startup?]]

Lower the =gnus-activate-level= so _groups_ at higher levels won't be
activated. _Groups_ are created with subscription level of
=gnus-level-default-subscribed=. This req. using =S l= over your =nnimap= groups
to alter their subscription level.

*** Agent and Plugging


*** Daemons

See [[https://www.gnu.org/software/emacs/manual/html_node/gnus/Daemons.html][Daemons]]

Add to the list =gnus-daemon-handles= to schedule functionality. Adding handlers
requires running =(gnus-demon-init)=

By default, available handlers are:

+ gnus-demon-add-disconnection :: disconnect from your servers
+ gnus-demon-add-nntp-close-connection
+ gnus-demon-add-scan-timestamps
+ gnus-demon-add-rescan
+ gnus-demon-add-scanmail :: for mail backends (nnmail, nnimap, etc), but will
  reopen a closed connection.

**** Auto-fetch =nnimap= mail when not =closed=

... I think I forgot about the Gnus Agent, so the =gnus-demon= callbacks
probably aren't the best way to do this.

#+begin_example emacs-lisp
(defun gnus-server-status (method)
  "Return the status of METHOD."
  (nth 1 (assoc method gnus-opened-servers)))
#+end_example

Use =gnus-server-staus= from =gnus.el=

#+begin_src
(gnus-server-status '(nnimap "imap.gmail.com"))
#+end_src

A little unwieldy for noobs, since you need to query on an exact list containing
many of the connection details.

#+begin_src emacs-lisp
(pp gnus-opened-servers)
#+end_src

#+RESULTS:
#+begin_example
(((nndraft "")
  ok)
 ((nntp "news.gmane.io")
  ok)
 ((nnfolder "archive"
            (nnfolder-directory "~/Mail/archive")
            (nnfolder-active-file "~/Mail/archive/active")
            (nnfolder-get-new-mail nil)
            (nnfolder-inhibit-expiry t))
  ok)
 ((nnimap "imap.gmail.com")
  closed))
#+end_example




** Merging GNUS state

*** Recovering Group Subscriptions

Read the [[https://www.gnu.org/software/emacs/manual/html_mono/gnus.html#Startup-Files][Startup Files]] section in the manual. You should be able to import the
=.newsrc= file and run

* Data Storage

Since GNUS manages contains email related information, I want to be aware of
exactly what data is being stored where. To this end, I've "containerized" the
files that Gnus uses, to the extent possible and thus my paths are a bit
different.

Much of this information is in [[https://www.gnu.org/software/emacs/manual/html_mono/gnus.html#Choosing-a-Mail-Back-End][Choosing a Mail Back End]].

|-------------------+-----------------------------------------------------|
| Path              | Desc                                                |
|-------------------+-----------------------------------------------------|
| $HOME/.newsrc     | This file generates the =.newsrc.eld=               |
| $HOME/.newsrc.eld | This file contains metadata and session-based data. |
| $HOME/Mail        | Mail folders                                        |
| $HOME/News        | These are the                                       |
|-------------------+-----------------------------------------------------|

If you have =no-littering=,

** nnfolder ([[https://www.gnu.org/software/emacs/manual/html_mono/gnus.html#Mail-Folders][Mail Folders]])

These servers are backed by the file system and usually stored in =~/Mail= or
whatever =message-directory= is set to. This is stored in the =mbox= format.

* Notes


** Concepts

+ Un/Plugged :: Whether you're connected to the online source
+ Agent ::
+ Topics ::
+ Scores ::

** Modes

+ Server Mode
+ Browse Server Mode
+ Group Mode
+ Summary Mode
+ Article Mode

** Code

*** Data Structures

**** cl-defstruct

|--------------+----------------+--------+----------------+-------------------------------------------------------------------------|
| file         | name           | type   | constructor    | slots                                                                   |
|--------------+----------------+--------+----------------+-------------------------------------------------------------------------|
| nnheader.el  | (mail-header   | vector |                | number  subject  from  date  id  references  chars  lines  xref  extra  |
| nnimap.el    | nnimap         |        |                |                                                                         |
| mm-uu.el     | (mm-uu-entry   | list   | nil            | type beginning-regexp end-regexp function-extract function-1 function-2 |
| gnus.el      | (gnus-info     |        | gnus-info-make | group rank read marks method params                                     |
| gnus-sum.el  | (gnus-data     | list   | gnus-data-make | number mark pos header level                                            |
|--------------+----------------+--------+----------------+-------------------------------------------------------------------------|


|----------------+------------------+------------------+-----------------+-------------------+-------------------+---------------------+-------------------------+---------------------+-----------------+-----------------+-----------------------------|
| name           | slot (type, def) |                  |                 |                   |                   |                     |                         |                     |                 |                 |                             |
|----------------+------------------+------------------+-----------------+-------------------+-------------------+---------------------+-------------------------+---------------------+-----------------+-----------------+-----------------------------|
| nnmaildir--art | prefix  (string) | suffix  (string) | num  (natnum)   | msgid  (string)   | nov  (vector)     |                     |                         |                     |                 |                 |                             |
| nnmaildir--grp | name   (string)  | new    (list)    | cur    (list)   | min    (natnum 1) | count  (natnum 0) | nlist  (list)       | flist  (hash-table)     | mlist  (hash-table) | cache  (vector) | index  (natnum) | mmth  (hash-table)          |
| nnmaildir--srv | address (string) | method (list)    | prefix (string) | dir (string)      | ls (function)     | groups (hash-table) | curgrp (nnmaildir--grp) | error (string)      | mtime (list)    | gnm             | target-prefix (string type) |
|----------------+------------------+------------------+-----------------+-------------------+-------------------+---------------------+-------------------------+---------------------+-----------------+-----------------+-----------------------------|

And also, =nnimap= with no specified slots/structure:

|--------+-------------------+----------+--------------+---------------+----------------|
| group  | process           | commands | capabilities | select-result | newlinep       |
| server | last-command-time | greeting | examined     | stream-type   | initial-resync |
|--------+-------------------+----------+--------------+---------------+----------------|

** Configuration

*** NNTP Server

- stores messages in gnus-directory =~/News=
- fetches from =$NNTPSERVER= or =/etc/nntpserver=
- caches state in =~/.newsrc=
- gnus-home-directory
  - gnus-startup-file
  - gnus-init-file
  - gnus-directory (set to SAVEDIR if defined)

*** Email

Before GNUS starts, you need to have the following configured:

+ You need =auth-sources= set up for =imap.gmail.com=
+ You have have such a method configured in =gnus-select-method= or
=gnus-secondary-select-method=

My config for this looks like:

#+begin_src emacs-lisp
(setq gnus-select-method '(nnimap "imap.gmail.com")
      gnus-secondary-select-methods '((nntp "news.gmane.io"))
      message-send-mail-hook #'smtpmail-send-it
      gnus-message-archive-group "\"Gmail]/Sent Mail\"")
#+end_src

*** Other

Some config values that seemed interesting useful at the time, mostly from an
embark buffer from when I found the best way to configure NNTP was with
=/etc/nntpserver=. You can tell I talk to a lot of people who use Emacs.

#+begin_src emacs-lisp
;; gnus-newsrc-alist
;; gnus-newsrc-hashtb
;; gnus-newsrc-options
;; gnus-newsrc-options-n
;; gnus-save-newsrc-hook
;; gnus-newsrc-file-version
;; gnus-read-newsrc-el-hook
;; gnus-save-quick-newsrc-hook
;; gnus-newsrc-last-checked-date
;; gnus-save-standard-newsrc-hook
;; gnus-save-newsrc-file-last-timestamp
#+end_src




** Treating

Options for [[https://www.gnu.org/software/emacs/manual/html_node/gnus/Customizing-Articles.html][customizing article]] display. prefix: =gnus-treat-=

+ buttonize
+ buttonize-head
+ capitalize-sentences
+ overstrike


*** Highlighting

**** [[https://www.gnu.org/software/emacs/manual/html_node/gnus/Article-Highlighting.html][Articles]]

Out of the box, Gnus will highlight headers/citation/etc.

+ Tweak =gnus-header-face-alist= to customize
+ Not everyone follows [[https://www.gnu.org/software/emacs/manual/html_node/gnus/Article-Signature.html][RFC 5536]] though ....

*** Patches/Diffs

[[https://github.com/orgcandman/emacs-plugins/blob/master/gnus-article-treat-patch.el][orgcandman gnus-article-treat-patch]]:

+ other variants: [[https://github.com/redguardtoo/emacs.d/blob/master/site-lisp/gnus-article-treat-patch/gnus-article-treat-patch.el][redguardtoo]] (+10yrs) and velkyel (~ 3yrs?)
+ equiv for [[https://github.com/seanfarley/message-view-patch][mu4e]]

[[https://github.com/mgalgs/diffview-mode][mgalgs/diffview-mode]]: compare patch with extant source tree

+ i think other patchtools already do this)

** Interface

Manual Pages ([[https://www.gnu.org/software/emacs/manual/html_node/gnus/Various.html][Gnus Interface]])

+ [[https://www.gnu.org/software/emacs/manual/html_node/gnus/Tabbed-Interface.html][Tabbed interface]]
+ [[https://www.gnu.org/software/emacs/manual/html_node/gnus/Highlighting-and-Menus.html][Highlighting and Menus]]


*** TODO enumerate variables of interest

article

+ gnus-visible-headers & gnus-sorted-header-list
+ gnus-thread-sort-functions (takes a list, many options)

group

+ gnus-level-[un]subscribed (also zombie/killed)
+ gnus-group-sort-functions
+ gnus-topic-display-empty-topics

summary

+ gnus-summary-ignore-duplicates
+ gnus-auto-select-first
+ gnus-sum-thread-tree-*

*** Formatting

**** Overview


See [[https://www.gnu.org/software/emacs/manual/html_node/gnus/Formatting-Variables.html][formatting variables]]. Tables below contain stuff from embark, defaults.

See =M-x gnus-update-format= and =gnus-update-format-specifications=. Gnus
doesn't use the emacs =font-lock-mode=

The critical features. Variables with a =-format= usually have a =-alist= that
describes how the =-spec= is formed.

|--------------+-------------------+------------------------------------+---------------------------------------------------------------------|
| gnus-article | mode-line-format  | Gnus: %g %S%m                      | The format specification for the article mode line.                 |
| gnus-article | time-format       | %a, %d %b %Y %T %Z                 | Format for display of Date headers in article bodies.               |
|--------------+-------------------+------------------------------------+---------------------------------------------------------------------|
| gnus-group   | line-format       | %M%S%p%P%5y:%B%(%g%)\n             | Format of group lines.                                              |
| gnus-group   | mode-line-format  | Gnus: %%b {%M%:%S}                 | The format specification for the group mode line.                   |
|--------------+-------------------+------------------------------------+---------------------------------------------------------------------|
| gnus-server  | line-format       | {%(%h:%w%)} %s%a%c\n               | Format of server lines.                                             |
| gnus-server  | mode-line-format  | Gnus: %%b                          | The format specification for the server mode line.                  |
|--------------+-------------------+------------------------------------+---------------------------------------------------------------------|
| gnus-summary | dummy-line-format | %(:                                | The format specification for the dummy roots in the summary buffer. |
| gnus-summary | line-format       | %U%R%z%I%(%[%4L: %-23,23f%]%) %s\… | The format specification of the lines in the summary buffer.        |
| gnus-summary | mode-line-format  | Gnus: %g [%A] %Z                   | The format specification for the summary mode line.                 |
| gnus-summary | pick-line-format  | %-5P %U%R%z%I%(%[%4L: %-23,23n%]%… | The format specification of the lines in pick buffers.              |
|--------------+-------------------+------------------------------------+---------------------------------------------------------------------|

Misc

|---------------+---------------------------------+----------------------------+-----------------------------------------------------------------|
| gnus-category | line-format                     | %(%20c%): %g\n             | Format of category lines.                                       |
| gnus-category | mode-line-format                | Gnus: %%b                  | The format specification for the category mode line.            |
|---------------+---------------------------------+----------------------------+-----------------------------------------------------------------|
| gnus-cited    | closed-text-button-line-format  | %(%{[+]%}%)\n              | Format of closed cited text buttons.                            |
| gnus-cited    | opened-text-button-line-format  | %(%{[-]%}%)\n              | Format of opened cited text buttons.                            |
|---------------+---------------------------------+----------------------------+-----------------------------------------------------------------|
| gnus-diary    | summary-line-format             | %U%R%z %uD: %(%s%) (%ud)\n | Summary line format for nndiary groups.                         |
| gnus-diary    | time-format                     | %a, %b %e %y, %H:%M        | Time format to display appointments in nndiary summary buffers. |
|---------------+---------------------------------+----------------------------+-----------------------------------------------------------------|
| gnus-mime     | button-line-format              | %{%([%p. %d%T]%)%}%e\n     | Format of the MIME buttons.                                     |
| gnus-mime     | security-button-end-line-format | %{%([[End of %t]%D]%)%}\n  | The following specs can be used:                                |
| gnus-mime     | security-button-line-format     | %{%([[%t:%i]%D]%)%}\n      | The following specs can be used:                                |
|---------------+---------------------------------+----------------------------+-----------------------------------------------------------------|
| gnus-topic    | line-format                     | %i[ %(%{%n%}%) -- %A ]%v\n | Format of topic lines.                                          |
|---------------+---------------------------------+----------------------------+-----------------------------------------------------------------|
| gnus-tree     | line-format                     | %(%[%3,3n%]%)              | Format of tree elements.                                        |
| gnus-tree     | mode-line-format                | Gnus: %%b %S %Z            | The format specification for the tree mode line.                |
|---------------+---------------------------------+----------------------------+-----------------------------------------------------------------|

+ gnus-next-page-line-format: =%{%(Next page...%)%}\n=
+ gnus-prev-pageline-format: =%{%(Previous page...%)%}\n=

**** Summary

+ Article [[https://www.gnu.org/software/emacs/manual/html_node/gnus/Setting-Process-Marks.html][Process Mark]]

***** Format String Comparison

Default =%U%R%z%I%(%[%4L: %-23,23f%]%) %s\n=

#+begin_quote
  [  23: Ludovic Courtès        ] Re: Guix / Nix Benchmarks
       <  16: Ricardo Wurmus         >
           [  26: Wilko Meyer            ]
               [  31: Ricardo Wurmus         ]
 #+end_quote

=%U%R%z %(%&user-date; %B%-3L %[%f%]%) %s\n=

#+begin_quote
  July 02 ○─► 23  [Ludovic Courtès] Re: Guix / Nix Benchmarks
    July 02  └─► 16  <Ricardo Wurmus>
    July 02   └─► 26  [Wilko Meyer]
    July 03    └─► 31  [Ricardo Wurmus]
#+end_quote

=%U%R %-18,18&user-date; %4L:%-25,25f %B%s\n=

#+begin_quote
   July 02              18:Ludovic Courtès           ■ Re: Packaging Con
   July 02              23:Ludovic Courtès           ○─► Re: Guix / Nix Benchmarks
   July 02              16:Ricardo Wurmus             └─►
   July 02              26:Wilko Meyer                 └─►
   July 03              31:Ricardo Wurmus               └─►
#+end_quote

kitnil =%U%R %d %i %I%(%[%4L: %-23,23f%]%) %s\n=

#+begin_quote
   02-Jul 0 [  18: Ludovic Courtès        ] Re: Packaging Con
   02-Jul 0 [  23: Ludovic Courtès        ] Re: Guix / Nix Benchmarks
   02-Jul 0     <  16: Ricardo Wurmus         >
   02-Jul 0         [  26: Wilko Meyer            ]
   03-Jul 0             [  31: Ricardo Wurmus         ]
#+end_quote

And from =gnus-all-the-icons=. I'm not sure what this does.

#+begin_src emacs-lisp
(concat "%1{%U%R%z: %}%[%2{%&user-date;%}%] "
        (propertize ;(all-the-icons-faicon "male")
         (all-the-icons-material "person")
         'display '(raise 0.0))
        " %4{%-34,34n%} %3{"
        (propertize ;(all-the-icons-faicon "terminal")
         (all-the-icons-material "send")
         'display '(raise 0.0))
        " %}%(%1{%B%}%s%)\n")
#+end_src

+ Updating req. running =gnus-group-restart= or =gnus-update-format=. I haven't
  figured the second one out yet, but there's definitely some cached state.

***** Format String Alist

The =gnus-summary-line-format-alist= variable:

|--------+------+--------------+-----------------------+--------------------------------------------------------|
| type   | char | source       | meaning               | desc                                                   |
|--------+------+--------------+-----------------------+--------------------------------------------------------|
| int    | %N   | mail-header  | number                |                                                        |
| string | %S   | mail-header  | subject               |                                                        |
| string | %s   |              | subject or nil        |                                                        |
| string | %n   |              | gnus-tmp-name         |                                                        |
| string | %A   |              | from (address)        |                                                        |
| string | %a   |              | from (name)           |                                                        |
| string | %F   |              | from                  |                                                        |
| string | %x   | mail-header  | xref                  |                                                        |
| string | %D   | mail-header  | date                  |                                                        |
| string | %d   | mail-header  | date                  | (gnus-dd-mmm (mail-header-date gnus-tmp-header))       |
| string | %o   | mail-header  | date                  | (gnus-date-iso8601 (mail-header-date gnus-tmp-header)) |
| string | %M   | mail-header  | id                    |                                                        |
| string | %r   | mail-header  | references            |                                                        |
| int    | %c   | mail-header  | chars                 |                                                        |
| string | %k   |              | summary line          | pretty printed message size, # bytes                   |
| string | %L   |              | lines                 | gnus-tmp-lines                                         |
| int    | %Z   | mail-header  | number                |                                                        |
| string | %G   | mail-header  | group                 |                                                        |
| string | %g   | mail-header  | group (short)         |                                                        |
| bool   | %O   |              | downloaded            |                                                        |
| string | %I   |              | indentation           |                                                        |
| string | %T   |              | thread root formatter | hide rest of summary if a root article                 |
| bool   | %R   |              | replied               |                                                        |
| string | %[   |              | opening-bracket       |                                                        |
| string | %]   |              | closing-bracket       |                                                        |
| string | %>   |              | level (depth)         | string where length = gnus-tmp-level                   |
| string | %<   |              | level (depth)         | string where length = max(20 -gnus-tmp-level)          |
| int    | %i   |              | score                 |                                                        |
| bool   | %z   |              | score-char            |                                                        |
| int    | %V   | gnus-thread  | total score           | (gnus-thread-total-score  ...)                         |
| bool   | %U   |              | unread                |                                                        |
| string | %f   | header/from  | name, To header       |                                                        |
| int    | %t   |              | # subthread articles  |                                                        |
| bool   | %e   |              | article has children? |                                                        |
| string | %u   | user-defined | user-defined          |                                                        |
| int    | %P   |              | line number           | (gnus-pick-line-number)                                |
| string | %B   |              | thread tree header    | thread-tree-header-string                              |
|--------+------+--------------+-----------------------+--------------------------------------------------------|

+ =%&user-date= provides a custom format for dates
+ for fields marked =mail-header= most of the descriptions correspond to (or are
  at least derived from) the cl-defstruct slot accessor -- e.g. =xref= is
  =(mail-header-xref mail-record)=

***** Summary Tree

+ Need to ensure the =gnus-summary-line-format= has =%B= instead of =%I=
=%U%R%z%I%(%[%4L: %-23,23f%]%) %s=

Some examples of settings. See [[https://www.emacswiki.org/emacs/GnusFormatting#h5o-1][Emacs Wiki]] for more info

These are used along with =gnus-summary-line-format= and its alist below.

****** BonFaceKilz

#+begin_src emacs-lisp
(when window-system
  (setq gnus-sum-thread-tree-indent " ")
  (setq gnus-sum-thread-tree-root "") ;; "● "
  (setq gnus-sum-thread-tree-false-root "") ;; "◯ "
  (setq gnus-sum-thread-tree-single-indent "") ;; "◎ "
  (setq gnus-sum-thread-tree-vertical    "│")
  (setq gnus-sum-thread-tree-leaf-with-other "├─► ")
  (setq gnus-sum-thread-tree-single-leaf   "╰─► "))
#+end_src

****** Alezost

#+begin_src emacs-lisp
(setq
 gnus-sum-thread-tree-root            "●─► "
 gnus-sum-thread-tree-false-root      "○─► "
 gnus-sum-thread-tree-vertical        "│"
 gnus-sum-thread-tree-leaf-with-other "├─► "
 gnus-sum-thread-tree-single-leaf     "└─► "
 gnus-sum-thread-tree-indent          " "
 gnus-sum-thread-tree-single-indent   "■ "
 gnus-summary-newsgroup-prefix        "⇒ "
 gnus-summary-to-prefix               "→ ")
#+end_src


****** dcunited001


This is basically the same charset as Alezost's above.


#+begin_src emacs-lisp
(setq gnus-summary-line-format "%U%R%z %d %B%-3L %[%f%] %s\n"
      gnus-sum-thread-tree-root            "☼──► "
      gnus-sum-thread-tree-false-root      "○┬─► "
      gnus-sum-thread-tree-vertical        "│"
      gnus-sum-thread-tree-leaf-with-other "├•─► "
      gnus-sum-thread-tree-single-leaf     "└•─► "
      gnus-sum-thread-tree-indent          " "
      gnus-sum-thread-tree-single-indent   "■ "
      gnus-summary-newsgroup-prefix        "⇒ "
      gnus-summary-to-prefix               "→ ")
#+end_src

Alternatives:

#+begin_src emacs-lisp
(setq gnus-summary-line-format "%U%R%z %d %B%-3L %[%f%] %s\n"

      gnus-sum-thread-tree-root            "╦═► "
      gnus-sum-thread-tree-false-root      "○╦═► "
      gnus-sum-thread-tree-vertical        "│"
      gnus-sum-thread-tree-leaf-with-other "├╤═► "
      gnus-sum-thread-tree-single-leaf     "└╤═►"
      gnus-sum-thread-tree-indent          " "
      gnus-sum-thread-tree-single-indent   "■ "
      gnus-summary-newsgroup-prefix        "⇒ "
      gnus-summary-to-prefix               "→ ")

(setq gnus-summary-line-format "%U%R%z %d %B%-3L %[%f%] %s\n"

      gnus-sum-thread-tree-root            "■═► "
      gnus-sum-thread-tree-false-root      "○╥─► "
      gnus-sum-thread-tree-vertical        "│"
      gnus-sum-thread-tree-leaf-with-other "╠╤═► "
      gnus-sum-thread-tree-single-leaf     "╚╤═►"
      gnus-sum-thread-tree-indent          " "
      gnus-sum-thread-tree-single-indent   "■ "
      gnus-summary-newsgroup-prefix        "⇒ "
      gnus-summary-to-prefix               "→ ")

(setq gnus-summary-line-format "%U%R%z %d %B%-3L %[%f%] %s\n"

      gnus-sum-thread-tree-root            "○╦═► "
      gnus-sum-thread-tree-false-root      "╥─► "
      gnus-sum-thread-tree-vertical        "║"
      gnus-sum-thread-tree-leaf-with-other "╟──► "
      gnus-sum-thread-tree-single-leaf     "╙──►"
      gnus-sum-thread-tree-indent          " "
      gnus-sum-thread-tree-single-indent   "■ "
      gnus-summary-newsgroup-prefix        "⇒ "
      gnus-summary-to-prefix               "→ ")

#+end_src


**** Group

The workflow for customizing this one only requires using =g= to refresh the
groups buffer.


***** dcunited001

Though I have almost no experience using =gnus=, this formatting works well with
the =gnus-topic-mode= set in the =*Group*= buffer.

#+begin_src emacs-lisp
(setq gnus-group-line-format "%-40,40c │%7y│%5T│%5R│%B%M%S%p│\n"
      gnus-group-uncollapsed-levels 2)
#+end_src

It ends up looking like this. I still need to figure out how to control the
sorting of individual servers/sources. I think there is somewhere to configure a
line at the top which would explain the meaning of the columns.

+ # unread, unticked, non-dormant :: the volume of content remaining
+ # ticked :: the number of ticked (or pinned) articles
+ # read :: the metric I should gamify to increase first

The last column contains character indicators:

+ %B :: Whether there's a summary buffer currently open
+ %M :: When there is new mail: =%=
+ %S :: Whether the group is subscribed
+ %p :: When the group is [[https://www.gnu.org/software/emacs/manual/html_node/gnus/Marking-Groups.html][process-marked]] for external processing: =#=


#+begin_quote
[ Gnus -- 1323085 ]
  [ Academic -- 92108 ]
news:g.c.e.f.tech.papers                 │  12990│    0│    0│    │
news:g.e.u.s.call-for-paper.category     │  18752│    0│    0│    │
news:g.o.c.a.papers.b2aba772-7680-       │  60366│    0│    0│    │
  [ Gmail -- 6687 ]
Gmail/Important                          │      2│   20│  292│    │
GNU/Guix                                 │   2387│    0│  147│    │
INBOX                                    │    140│   25│  687│    │
Programming/org-roam                     │      6│    0│    6│    │
Programming/xkeyboard                    │    800│    0│   89│    │
Gmail/All Mail                           │   3345│   25│ 2228│    │
Gmail/Spam                               │      7│    0│ 1418│    │
Gmail/Starred                            │      0│   26│   30│ *  │
  [ Guix -- 753359 ]
news:g.c.g.guix.announce                 │     43│    0│    0│    │
news:g.c.g.guix.bugs                     │  37139│    1│   26│    │
news:g.c.g.guix.ci                       │ 242830│    0│    0│    │
news:g.c.g.guix.devel                    │  67998│    0│   63│    │
news:g.c.g.g.gwl.devel                   │    130│    0│    0│    │
news:g.c.g.guix.patches                  │  52577│    0│    9│    │
news:g.c.g.guix.science                  │    248│    0│    0│    │
news:g.c.g.guix.scm                      │ 197560│    0│    0│    │
news:g.c.g.guix.user                     │  17125│    0│   23│    │
news:g.c.g.nonguix.nonguix               │    429│    0│    5│    │
news:g.c.l.tag.guix                      │     12│    0│    0│    │
news:g.o.g.g.ci.events                   │ 137137│    0│    0│    │
news:g.o.g.g.feeds.blog                  │     76│    0│    0│    │
news:g.o.g.g.hpc.blog                    │     55│    0│    0│    │
  [ Gutenberg -- 75525 ]
news:g.c.l.e.g.announce.monthly          │    195│    0│    0│    │
news:g.c.l.e.g.announce.posted           │  32562│    0│    0│    │
news:g.c.l.e.g.announce.weekly           │    673│    0│    0│    │
news:g.c.l.e.gutenberg.volunteers        │  20297│    0│    0│    │
#+end_quote

**** Tree Display For Threads

Set =gnus-use-trees=.

Default appearance

#+begin_src emacs-lisp
{***}
  |--------------------\
<Dar>                   <Max>
  |--\-----\-----\        |--\
[Dar] [Wil] [Ste] [Ste] [abc] [Dar]
  |                             |
[Jer]                         [Kat]
                                |
                              [Mic]
                                |
                              [Wil]
                                |
                              [Chr]
#+end_src

To customize tree appearance:

These variables are marked internal, though =gnus-generate-tree-function= can be
set to =gnus-generate-(horizontal|vertical)-tree= or =other=

|-----------+--------------------+-----+---|
| prefix    | var                | def |   |
|-----------+--------------------+-----+---|
| gnus-tree | brackets           |     |   |
| gnus-tree | line-format        |     |   |
| gnus-tree | node-length        |     |   |
| gnus-tree | parent-child-edges |     |   |
| gnus-tree | line-format-alist  |     |   |
| gnus-tree | mode-syntax-table  |     |   |
| gnus-tree | mode-abbrev-table  |     |   |
|-----------+--------------------+-----+---|

*** Windows and Buffers

**** gnus-buffer-configuration

From the [[https://www.gnu.org/software/emacs/manual/html_node/gnus/Window-Layout.html][manual]]

 | group               | vertical 1.0 | group 1.0 point        |                              |             |
 | summary             | vertical 1.0 | summary 1.0 point      |                              |             |
 | article (w/  trees) | vertical 1.0 | summary 0.25 point     | tree 0.25                    | article 1.0 |
 | article (w/o trees) | vertical 1.0 | summary 0.25 point     | article 1.0                  |             |
 | server              | vertical 1.0 | server 1.0 point       |                              |             |
 | browse              | vertical 1.0 | browse 1.0 point       |                              |             |
 | message             | vertical 1.0 | message 1.0 point      |                              |             |
 | pick                | vertical 1.0 | article 1.0 point      |                              |             |
 | info                | vertical 1.0 | info 1.0 point         |                              |             |
 | summary-faq         | vertical 1.0 | summary 0.25           | faq 1.0 point                |             |
 | only-article        | vertical 1.0 | article 1.0 point      |                              |             |
 | edit-article        | vertical 1.0 | article 1.0 point      |                              |             |
 | edit-form           | vertical 1.0 | group 0.5              | edit-form 1.0 point          |             |
 | edit-score          | vertical 1.0 | summary 0.25           | edit-score 1.0 point         |             |
 | edit-server         | vertical 1.0 | server 0.5             | edit-form 1.0 point          |             |
 | post                | vertical 1.0 | post 1.0 point         |                              |             |
 | reply               | vertical 1.0 | article 0.5            | message 1.0 point            |             |
 | forward             | vertical 1.0 | message 1.0 point      |                              |             |
 | reply-yank          | vertical 1.0 | message 1.0 point      |                              |             |
 | mail-bounce         | vertical 1.0 | article 0.5            | message 1.0 point            |             |
 | pipe                | vertical 1.0 | summary 0.25 point     | "*Shell Command Output*" 1.0 |             |
 | bug                 | vertical 1.0 | "*Gnus Bug*" 1.0 point |                              |             |
 | score-trace         | vertical 1.0 | summary 0.5 point      | "*Score Trace*" 1.0          |             |
 | score-words         | vertical 1.0 | summary 0.5 point      | "*Score Words*" 1.0          |             |
 | split-trace         | vertical 1.0 | summary 0.5 point      | "*Split Trace*" 1.0          |             |
 | category            | vertical 1.0 | category 1.0           |                              |             |
 | compose-bounce      | vertical 1.0 | article 0.5            | message 1.0 point            |             |
 | display-term        | vertical 1.0 | "*display*" 1.0        |                              |             |
 | mml-preview         | vertical 1.0 | message 0.5            | mml-preview 1.0 point        |             |

*** Links

**** Article Headers

header regexp button form callback par
* Commands

Most commands seem to be grouped in categories associated to capital
letters. The descriptions here are mostly generated from the refcard sections.

** Group

+ A :: List groups
+ G :: Create & Edit Groups
+ H :: Group Info
+ S :: Unsub, Yank and Kill
+ M :: Mark Groups
+ D :: Sieve Scripts
+ J :: Plug & Unplug
+ T :: Group Topics

** Summary

+ A :: Scroll, Fetch, Process/Translate
+ G :: Select Articles
+ T :: Threading
+ / :: Limit, Filter, Search
+ V :: Score & Value
+ O :: Output Articles
+ X :: Extract Series
+ K :: MIME Ops from Summary Buffer
+ W M :: Additional MIME/Decoding ops
+ S :: Post, Followup, Reply, FWD, Cancel
+ M :: Mark
+ M V :: Mark Based on Score
+ M P :: The Process Mark
+ C-c C-s :: Sort the summary Buffer
+ C-c C-f :: Jumping in the Message Buffer
+ C-c C-m :: Attachements/MML

** Article

+ W :: Wash commands
+ W E :: Blank lines and whitespace
+ W D :: Picons, X-Faces, Smileys
+ W T :: Time and Date
+ W W :: Hide parts of the article
+ W H :: Highlight parts of the article

* Ref Card

[[https://www.gnu.org/software/emacs/refcards/pdf/gnus-refcard.pdf][GNUS 5.11 Reference Card]]

|-----+---------+------|
| Key | Command | Desc |
|-----+---------+------|
|     |         |      |
|-----+---------+------|

** Group Mode

Control

|-----+---------+---------------------------------|
| Key | Command | Desc                            |
|-----+---------+---------------------------------|
| q/Q |         | Quit GNUS (without saving)      |
| z   |         | suspend (kill all Gnus buffers) |
| Z   |         | clear the dribble buffer        |
| r   |         | reread the init script (reset)  |
| R   |         | Restart Gnus                    |

Navigation

|---------+---------+----------------------------------------------|
| Key     | Command | Desc                                         |
|---------+---------+----------------------------------------------|
| </>     |         | beginning/end of buffer                      |
| n/p     |         | next/prev (with unread)                      |
| N/P     |         | next/prev                                    |
| M-n/M-p |         | next/prev group on same or lower level       |
| ,/.     |         | jump to first/lowest-level group with unread |
| j       |         | jump to a group                              |
|---------+---------+----------------------------------------------|

Interact

|-------+---------+-----------------------------------------------------|
| Key   | Command | Desc                                                |
|-------+---------+-----------------------------------------------------|
| a     |         | post an article to a group                          |
| C-u a |         | post, using group under point to find posting style |
| m     |         | mail a message to someone                           |
| C-u m |         | mail, using group under point to find posting style |
|       |         |                                                     |

*** Group Subscribedness-Levels

*** List Groups

*** Create/Edit Foreign Groups

*** Unsubscribe, Kill and Yank Groups

*** Mark Groups

*** Group-Unplugged

*** Group Topics

Prefix T

|---------+---------+----------------------------------|
| Key     | Command | Desc                             |
|---------+---------+----------------------------------|
| j       |         | jump                             |
| n       |         | new                              |
| m/c     |         | move/copy group to topic         |
| M/C     |         | move/copy groups matching regexp |
| M-n/M-p |         | next/prev topic                  |
| s/h     |         | show/hide                        |
| r       |         | rename topic                     |
|---------+---------+----------------------------------|

Other commands:

+ C-k/C-y :: kill/yank group or topic

**** Topic Sorting

** Summary Mode

+ Gnus will hide the messages you've already read. Use =/o= too show these.
+ Use =Y g= to refresh the summary buffer.

*** Select Articles

*** Threading

*** Limiting

*** Sort the Summary-Buffer

*** Score (Value) Commands

*** Output Articles

*** Extract Series (Uudecode etc)

*** MIME Operations from the Summary-Buffer

*** Post, Followup, Reply, Forward, Cancel

*** Message Composition

**** Jumping in message-buffer

**** Attachments/MML

*** Mark Articles

**** Mark Based on Score

**** The Process Mark

**** Mark Indication-Characters

*** Summary-Unplugged

*** Mail-Group Commands

*** Draft-Group Commands

*** Exit the Summary-Buffer

** Article Mode (reading)

*** Wash the Article-Buffer

**** Blank lines and Whitespace

**** Picons, X-Faces, Smileys

**** Time and Date

*** HIde/Highlight Parts of the Article

*** MIME operations from the Article-Buffer (reading)

** Server Mode

*** Unplugged-Server

** Browse Server Mode
